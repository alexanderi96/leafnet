{{template "_navbar.html" .}}
<div class="container center-block mt-3">
  <div class="row">
    <div class="card col-lg">
    	<div class="card-header bg-transparent" >
        {{if not .Person.Node.UUID}}
	      <h1 class="card-title">Add a new person</h1>
	      {{else}}
	      <h1 class="card-title">Edit {{.Person.FirstName}} {{.Person.LastName}}</h1>
	      {{end}}
	    </div>
    	<div class="card-body" >
	      <form id="addpersonform">
	      	<input type="hidden" id="uuid" name="uuid" value="{{.Person.Node.UUID}}" class="form-control">
	      	<div class="row g-2">
	      		<div class="col-md">
	      			<label class="form-label" for="first_name">First Name</label>
	    		    <input type="text" id="first_name" name="first_name" value="{{.Person.FirstName}}" class="form-control" placeholder="First Name" required>
	    		  </div>
	    		  <div class="col-md">
	  		      <label class="form-label" for="last_name">Last Name</label>
  		  			<input type="text" id="last_name" name="last_name" value="{{.Person.LastName}}" class="form-control" placeholder="Last Name" required>
	  		    </div>
	    		</div>
	    		<br>
	    		<div class="row g-2">
	      		<div class="col-md">
	    		    <label class="form-label" for="birth_date">Birth Date</label>
	        			<input type="date" id="birth_date" name="birth_date" class="form-control" placeholder="">
	        			<script type="text/javascript">
	        				setValue("birth_date", timestampToDate({{.Person.BirthDate}}))
	        			</script>
	    		  </div>
	    		  <div class="col-md">
	    		  	<label class="form-label" for="death_date">Death Date</label>
	    		  	<div class="input-group">
		    		  	<div class="input-group-text">
	                <input class="form-check-input" value="" aria-label="Checkbox for following input" type="checkbox" id="enableDeathDate" {{if .Person.DeathDate}}checked{{end}}>
	              </div>
	        			<input type="date" id="death_date" name="death_date" class="form-control" placeholder="">
		            <script type="text/javascript">
			        		setValue("death_date", timestampToDate({{.Person.DeathDate}}))
      					</script>
	    		  	</div>
	    		  </div>
	    		</div>
	    		<br>
	    		{{ if gt (len .Persons) 0 }}
	    		<div class="row g-2">
	      		<div class="col-md">
    		    	<label class="form-label" for="parent1">Parent 1</label>
    	        <select class="form-select" data-placeholder="Parent 1 select" id = "parent1">
  	            {{range $key, $value := .Persons}}
  	             <option value="{{$value.Node.UUID}}">{{$value.FirstName}} {{$value.LastName}}</option>
  	            {{end}}
  	          </select>
	    		  </div>
	    		  <div class="col-md">
	  		      <label class="form-label" for="parent2">Parent 2</label> 
    	        <select  class="form-select" data-placeholder="Parent 2 select" id = "parent2">
    	          {{range $key, $value := .Persons}}
    	           <option value = "{{$value.Node.UUID}}">{{$value.FirstName}} {{$value.LastName}}</option>
    	          {{end}}
				  <option value="">Select a person...</option>
    	        </select>
	  		    </div>
	    		</div>
	    		<br>
	    		{{end}}
	    		<div class="row g-2">
		    		<div class="col-md">
			        <label class="form-label" for="bio">Bio</label>
				      <textarea class="form-control" placeholder="Leave a comment here" id="bio" name="bio" style="height: 150px">{{.Person.Bio}}</textarea>
		      	</div>
	      	</div>
      </div>
	  <div class="card-footer bg-transparent" >
		<input type="submit" value="Save" class="btn btn-primary"/>
		<button class="btn btn-secondary" onclick="window.history.back()">Back</button>
		</div>

	</form>
    </div>
  </div>
</div>
<script type="text/javascript">
	function populateSelect() {
		$("#parent1").val("{{.Person.Parent1}}");
		$("#parent2").val("{{.Person.Parent2}}");

		$( 'select' ).select2( {
			theme: "bootstrap-5",
		} );
	};

	$(document).ready(function() {
		populateSelect();

		var enableDeathDate = document.getElementById("enableDeathDate");
		var deathDate = document.getElementById("death_date");

		// Enable/disable death date based on checkbox state
		enableDeathDate.addEventListener("change", function() {
			deathDate.disabled = !enableDeathDate.checked;
		});

		// Disable death date if checkbox is not checked on page load
		if (!enableDeathDate.checked) {
			deathDate.disabled = true;
		}

		// Evento che viene chiamato al submit del form
		$("#addpersonform").submit(function(event) {
			event.preventDefault();

			var uuid = $("#uuid").val();
			var first_name = $("#first_name").val();
			var last_name = $("#last_name").val();
			var birth_date = $("#birth_date").val() ? new Date($("#birth_date").val()).getTime() / 1000 : "";
			var death_date = $("#death_date").val() ? new Date($("#death_date").val()).getTime() / 1000 : "";
			var parent1 = $("#parent1").val();
			var parent2 = $("#parent2").val();
			var bio = $("#bio").val();

			$.post("/manageperson", {uuid: uuid, first_name: first_name, last_name: last_name, birth_date: birth_date, death_date: death_date, parent1: parent1, parent2: parent2, bio: bio}, function(data) {});
		});
	});
</script>
{{template "_footer.html" .}}